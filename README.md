# Tangxiaozhi-Rehibilitation
本仓库是开发运动模块与患者管理模块的数据库设计

## ER图

![ER](assets/ER.png)

## 数据库模式概述	
  本系统的数据库设计遵循3NF。一共有8个表，2个视图。
### 8个表：
  - 核心表是user，user的role表示角色，现阶段可以是患者，管理员等，未来可能会有医生、护士等。
  - 如果是病人，则用户的user_id等同于病人id，病人的核心表是profile，表示一些疾病相关的字段，比如既往病史，家族史，过敏史，并发症，身高，治疗方法，确诊年份，患糖尿病类型(I/II/妊娠)等等。
  - 由于病人可能会有多个并发症，因此需要单独设计一个complication表。
  - 病人每次锻炼，都会在exercise记录开始时间，持续时间，运动种类等等，每次锻炼由exercise_id唯一标识，每次锻炼都会对应一系列每3分钟记录一次的心率，对应于表heartrate。
  - 每隔15分钟记录一次血糖，数据在表glycemia中。
  - 病人可以自己设置运动方案，记录在表scenario中，运动方案包括开始与截止日期，频率，种类，强度，一天中的运动时间，由于主键是病人的ID，因此病人最多只能拥有1个运动方案，只能通过选择系统推荐方案或者自己去修改方案。
  - 病人可以定期检查，体检结果记录在表examine中，包含检测时间，血糖，血压，健康状况，睡眠质量。
### 2个视图：
  - daily_glycemia_summary 记录每日的最高与最低血糖。
  - weekly_glycemia_summary 记录每周的最高与最低血糖。
  - schedule 生成scenario方案对应的日程表。这里使用了MySQL的递归公共表达式CTE，用于生成数字序列，可以自己制定n的最大值为100，n个间隔加起始时间不得大于结束时间，这样n就有了2个限制条件。
### 1个Job
  - 由于每日生成了大量的血糖数据，因此需要只保留一周前血糖的最低值、最高值、最近似平均值。故创建一个Event，每天凌晨4点定期清除其余值。
